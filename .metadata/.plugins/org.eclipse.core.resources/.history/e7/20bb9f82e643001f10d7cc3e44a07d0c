<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.market.mapper.MemberMapper">
	<!-- ResultMap -->
	<resultMap type="com.market.dto.StoreDTO" id="store">
		<id column="SELLER_ID" property="sellerId" />
		<result column="BUYER_ID" property="buyerId"/>
		<result column="PRODUCT_NO" property="productNo"/>
		<result column="FOLLOWER_COUNT" property="followerCount"/>
		<result column="SALE_COUNT" property="saleCount"/>
		<result column="SALE_PRICE" property="salePrice"/>
		<result column="REVIEWS" property="reviews"/>
		<result column="SALE_STATUS" property="saleStatus"/>
	</resultMap>
	
	<select id="storeInfo" resultMap="store" parameterType="String">
		SELECT 
		P.PRODUCT_NO ,
		P.MEMBER_ID AS SELLER_ID,
		(SELECT BUYER_ID FROM REVIEW r WHERE R.PRODUCT_NO = P.PRODUCT_NO) AS BUYER_ID,
		P.PRODUCT_PRICE AS SALE_PRICE,
		P.PRODUCT_SALE AS SALE_STATUS,
		(SELECT COUNT(*) FROM PRODUCT p2 WHERE P2.MEMBER_ID = #{memberId}) AS SALE_COUNT,
		(SELECT COUNT(*) FROM FAVORITES f WHERE F.SELLER_ID = #{memberId}) AS FOLLOWER_COUNT,
		(SELECT REVIEW FROM REVIEW r WHERE R.PRODUCT_NO = P.PRODUCT_NO) AS REVIEW
		FROM PRODUCT p
		WHERE P.MEMBER_ID = #{memberId};
	</select>
	
</mapper>






